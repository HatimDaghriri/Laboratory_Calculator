<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jazan General Hospital - Laboratory Calculators v1.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0c2461, #1e3799);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            overflow: hidden;
        }
        
        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #0c2461, #1e3799);
            padding: 25px 30px;
            text-align: center;
            color: white;
            position: relative;
        }
        
        .hospital-name {
            font-size: 2.3rem;
            font-weight: 700;
            letter-spacing: 1px;
            margin-bottom: 5px;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .department-name {
            font-size: 1.4rem;
            font-weight: 400;
            opacity: 0.9;
            margin-bottom: 15px;
            color: #e0e0e0;
        }
        
        .calculator-title {
            font-size: 1.6rem;
            background: rgba(255, 255, 255, 0.15);
            padding: 12px 25px;
            border-radius: 50px;
            display: inline-block;
            margin-top: 10px;
        }
        
        .version {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        /* Main Content */
        .main-container {
            display: flex;
            min-height: 600px;
        }
        
        /* Calculator Navigation */
        .calculator-nav {
            width: 250px;
            background: #f8f9fa;
            border-right: 1px solid #e0e0e0;
            padding: 20px 0;
        }
        
        .nav-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin: 0 20px 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #1e3799;
        }
        
        .nav-btn {
            display: block;
            width: calc(100% - 10px);
            padding: 14px 20px;
            margin: 8px 5px;
            background: white;
            border: none;
            border-radius: 8px;
            text-align: left;
            font-size: 1rem;
            font-weight: 600;
            color: #2c3e50;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .nav-btn:hover, .nav-btn.active {
            background: linear-gradient(to right, #4a69bd, #1e3799);
            color: white;
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .nav-btn i {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }
        
        /* Calculator Content */
        .calculator-content {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
            background: #fafafa;
        }
        
        .calculator-section {
            display: none;
        }
        
        .calculator-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .calculator-info {
            margin-bottom: 25px;
            padding: 20px;
            background: #e3f7ff;
            border-radius: 10px;
            border-left: 4px solid #4a69bd;
        }
        
        .calculator-info h3 {
            color: #1a2980;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .calculator-info ul {
            padding-left: 20px;
            margin-top: 10px;
        }
        
        .calculator-info li {
            margin: 8px 0;
            line-height: 1.5;
        }
        
        .formula-box {
            margin: 20px 0;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 10px;
            border-left: 4px solid #1a2980;
        }
        
        .formula-title {
            font-weight: 700;
            margin-bottom: 10px;
            color: #1a2980;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .formula {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            overflow-x: auto;
            font-weight: 500;
        }
        
        .sample-id-group {
            margin-bottom: 25px;
        }
        
        /* Input Groups */
        .input-row {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .input-group {
            flex: 1;
            min-width: 250px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95rem;
        }
        
        input, select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fff;
        }
        
        input:focus, select:focus {
            border-color: #4a69bd;
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 105, 189, 0.2);
        }
        
        input:disabled, select:disabled {
            background-color: #f5f5f5;
            color: #666;
        }
        
        .units {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-left: 5px;
            font-weight: 500;
        }
        
        .gender-selection {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .gender-option {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .gender-option.selected {
            background: #4a69bd;
            color: white;
            border-color: #1e3799;
        }
        
        .gender-option:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            margin: 30px 0 20px;
        }
        
        button {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .calculate-btn {
            background: linear-gradient(to right, #1e3799, #4a69bd);
            color: white;
        }
        
        .reset-btn {
            background: #f1f2f6;
            color: #2c3e50;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        /* Results */
        .results {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e0e0e0;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .result-title {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.05rem;
        }
        
        .result-value {
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        /* Color coding for results */
        .normal { color: #27ae60; }
        .mild { color: #2980b9; }
        .moderate { color: #f39c12; }
        .severe { color: #e74c3c; }
        
        .interpretation {
            margin-top: 25px;
            padding: 20px;
            border-radius: 10px;
            color: #0d47a1;
            font-weight: 500;
            border-left: 4px solid #1a2980;
            background: #e3f7ff;
        }
        
        .interpretation-title {
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #1a2980;
        }
        
        .interpretation-content {
            line-height: 1.6;
        }
        
        /* Export Actions */
        .export-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .export-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            background: linear-gradient(to right, #4a69bd, #1e3799);
        }
        
        .export-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
            background: linear-gradient(to right, #1e3799, #4a69bd);
        }
        
        /* Sample Type Selection */
        .sample-type {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .type-btn {
            padding: 12px 20px;
            background: #e0e7ff;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #1e3799;
        }
        
        .type-btn.active {
            background: #4a69bd;
            color: white;
        }
        
        /* Footer */
        .reference {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 30px;
            text-align: center;
            padding: 20px;
            border-top: 1px solid #eee;
            background: #f8f9fa;
        }
        
        /* Print Styles */
        @media print {
            body {
                background: white;
                padding: 10px;
            }
            
            .container {
                box-shadow: none;
                max-width: 100%;
                margin: 0;
            }
            
            .header {
                background: white;
                color: #1a2980;
                padding: 15px;
            }
            
            .hospital-name {
                color: #1a2980;
                text-shadow: none;
            }
            
            .department-name {
                color: #555;
            }
            
            .calculator-nav, .btn-group, .sample-type, .calculator-info, .formula-box {
                display: none;
            }
            
            .calculator-content {
                padding: 10px;
            }
            
            .calculator-section {
                display: block !important;
                animation: none;
            }
            
            .calculator-section:not(.active) {
                display: none !important;
            }
            
            .results, .interpretation {
                margin: 10px 0;
                box-shadow: none;
                border: 1px solid #ddd;
            }
            
            .export-actions {
                display: none;
            }
        }
        
        /* Responsive Design */
        @media (max-width: 900px) {
            .main-container {
                flex-direction: column;
            }
            
            .calculator-nav {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
            }
            
            .nav-btn {
                text-align: center;
                justify-content: center;
            }
            
            .input-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .hospital-name {
                font-size: 1.8rem;
            }
            
            .department-name {
                font-size: 1.1rem;
            }
            
            .calculator-title {
                font-size: 1.3rem;
                padding: 10px 20px;
            }
        }
        
        @media (max-width: 600px) {
            .btn-group, .export-actions {
                flex-direction: column;
            }
            
            .gender-selection {
                flex-direction: column;
            }
            
            .sample-type {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="version">v1.0</div>
            <div class="hospital-name">Jazan General Hospital</div>
            <div class="department-name">Laboratory and Blood Department</div>
            <div class="calculator-title" id="current-calculator">24-Hour Urine Protein Calculator</div>
        </div>
        
        <div class="main-container">
            <div class="calculator-nav">
                <div class="nav-title"><i class="fas fa-calculator"></i> Calculators</div>
                <button class="nav-btn active" data-calc="urine-protein">
                    <i class="fas fa-vial"></i> 24h Urine Protein
                </button>
                <button class="nav-btn" data-calc="acr">
                    <i class="fas fa-vial-circle-check"></i> ACR (Albumin/Creatinine)
                </button>
                <button class="nav-btn" data-calc="egfr">
                    <i class="fas fa-heart-pulse"></i> eGFR Calculator
                </button>
                <button class="nav-btn" data-calc="osmolality">
                    <i class="fas fa-vial-virus"></i> Osmolality
                </button>
                <button class="nav-btn" data-calc="calcium">
                    <i class="fas fa-prescription-bottle"></i> Corrected Calcium
                </button>
            </div>
            
            <div class="calculator-content">
                <!-- 24-Hour Urine Protein Calculator -->
                <div class="calculator-section active" id="urine-protein-calculator">
                    <div class="calculator-info">
                        <h3><i class="fas fa-info-circle"></i> About 24-Hour Urine Protein Test</h3>
                        <p>This test measures the amount of protein in your urine over a 24-hour period. It helps diagnose kidney problems and monitor existing kidney conditions.</p>
                        <ul>
                            <li>Normal protein excretion: &lt; 150 mg/24h</li>
                            <li>Mild proteinuria: 150-500 mg/24h</li>
                            <li>Moderate proteinuria: 500-3500 mg/24h</li>
                            <li>Severe proteinuria (nephrotic range): &gt; 3500 mg/24h</li>
                        </ul>
                    </div>
                    
                    <div class="formula-box">
                        <div class="formula-title"><i class="fas fa-square-root-variable"></i> Formula</div>
                        <div class="formula">24h Protein (mg) = Urine Protein (mg/dL) × (Urine Volume (mL) / 100)</div>
                        <div class="formula">24h Protein (g) = 24h Protein (mg) / 1000</div>
                    </div>
                    
                    <div class="sample-id-group">
                        <label for="sample-id-urine">Sample ID <span class="units">(required)</span></label>
                        <input type="text" id="sample-id-urine" placeholder="Enter sample identification" required>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label for="urine-protein">Urine Protein <span class="units">(mg/dL)</span></label>
                            <input type="number" id="urine-protein" placeholder="e.g., 150">
                        </div>
                        
                        <div class="input-group">
                            <label for="urine-volume">Urine Volume <span class="units">(mL/24hr)</span></label>
                            <input type="number" id="urine-volume" placeholder="e.g., 1500">
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="calculate-btn" id="calculate-urine-protein">
                            <i class="fas fa-calculator"></i> Calculate
                        </button>
                        <button class="reset-btn" id="reset-urine-protein">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                    
                    <div class="results" id="urine-protein-results" style="display: none;">
                        <div class="result-item">
                            <div class="result-title">24-Hour Protein Excretion:</div>
                            <div class="result-value" id="protein-result">-</div>
                        </div>
                        
                        <div class="result-item">
                            <div class="result-title">Proteinuria Severity:</div>
                            <div class="result-value" id="protein-severity">-</div>
                        </div>
                    </div>
                    
                    <div class="interpretation" id="urine-protein-interpretation" style="display: none;">
                        <div class="interpretation-title"><i class="fas fa-stethoscope"></i> Clinical Interpretation</div>
                        <div class="interpretation-content" id="urine-protein-interpretation-text"></div>
                    </div>
                    
                    <div class="export-actions" id="urine-protein-export" style="display: none;">
                        <button class="export-btn pdf-btn" id="pdf-urine-protein">
                            <i class="fas fa-file-pdf"></i> Export to PDF
                        </button>
                        <button class="export-btn print-btn" id="print-urine-protein">
                            <i class="fas fa-print"></i> Print Report
                        </button>
                    </div>
                </div>
                
                <!-- ACR Calculator -->
                <div class="calculator-section" id="acr-calculator">
                    <div class="calculator-info">
                        <h3><i class="fas fa-info-circle"></i> About Albumin-to-Creatinine Ratio (ACR)</h3>
                        <p>The ACR test measures the ratio of albumin to creatinine in a spot urine sample. It's used to screen for kidney disease, especially in diabetic patients.</p>
                        <ul>
                            <li>Normal: &lt; 30 mg/g</li>
                            <li>Microalbuminuria: 30-300 mg/g</li>
                            <li>Macroalbuminuria: &gt; 300 mg/g</li>
                            <li>ACR is a more sensitive indicator than protein alone</li>
                        </ul>
                    </div>
                    
                    <div class="formula-box">
                        <div class="formula-title"><i class="fas fa-square-root-variable"></i> Formula</div>
                        <div class="formula">ACR (mg/g) = [Urine Albumin (mg/dL) / Urine Creatinine (mg/dL)] × 1000</div>
                    </div>
                    
                    <div class="sample-id-group">
                        <label for="sample-id-acr">Sample ID <span class="units">(required)</span></label>
                        <input type="text" id="sample-id-acr" placeholder="Enter sample identification" required>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label for="urine-albumin">Urine Albumin <span class="units">(mg/dL)</span></label>
                            <input type="number" id="urine-albumin" placeholder="e.g., 30">
                        </div>
                        
                        <div class="input-group">
                            <label for="urine-creatinine-acr">Urine Creatinine <span class="units">(mg/dL)</span></label>
                            <input type="number" id="urine-creatinine-acr" placeholder="e.g., 80">
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="calculate-btn" id="calculate-acr">
                            <i class="fas fa-calculator"></i> Calculate ACR
                        </button>
                        <button class="reset-btn" id="reset-acr">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                    
                    <div class="results" id="acr-results" style="display: none;">
                        <div class="result-item">
                            <div class="result-title">Albumin/Creatinine Ratio (ACR):</div>
                            <div class="result-value" id="acr-value">-</div>
                        </div>
                        
                        <div class="result-item">
                            <div class="result-title">Albuminuria Category:</div>
                            <div class="result-value" id="acr-category">-</div>
                        </div>
                    </div>
                    
                    <div class="interpretation" id="acr-interpretation" style="display: none;">
                        <div class="interpretation-title"><i class="fas fa-stethoscope"></i> Clinical Interpretation</div>
                        <div class="interpretation-content" id="acr-interpretation-text"></div>
                    </div>
                    
                    <div class="export-actions" id="acr-export" style="display: none;">
                        <button class="export-btn pdf-btn" id="pdf-acr">
                            <i class="fas fa-file-pdf"></i> Export to PDF
                        </button>
                        <button class="export-btn print-btn" id="print-acr">
                            <i class="fas fa-print"></i> Print Report
                        </button>
                    </div>
                </div>
                
                <!-- eGFR Calculator -->
                <div class="calculator-section" id="egfr-calculator">
                    <div class="calculator-info">
                        <h3><i class="fas fa-info-circle"></i> About eGFR Calculator</h3>
                        <p>Estimated Glomerular Filtration Rate (eGFR) assesses kidney function by calculating how much blood passes through glomeruli each minute.</p>
                        <ul>
                            <li>Normal: ≥90 mL/min/1.73m²</li>
                            <li>Mild reduction: 60-89 mL/min/1.73m²</li>
                            <li>Moderate reduction: 30-59 mL/min/1.73m²</li>
                            <li>Severe reduction: 15-29 mL/min/1.73m²</li>
                            <li>Kidney failure: &lt;15 mL/min/1.73m²</li>
                        </ul>
                    </div>
                    
                    <div class="formula-box">
                        <div class="formula-title"><i class="fas fa-square-root-variable"></i> Formula</div>
                        <div class="formula">eGFR = 141 × min(SCr/κ, 1)^α × max(SCr/κ, 1)^-1.209 × 0.993^Age × [1.018 if female]</div>
                        <p>Where: SCr = serum creatinine, κ = 0.7 (females) or 0.9 (males), α = -0.329 (females) or -0.411 (males)</p>
                    </div>
                    
                    <div class="sample-id-group">
                        <label for="sample-id-egfr">Sample ID <span class="units">(required)</span></label>
                        <input type="text" id="sample-id-egfr" placeholder="Enter sample identification" required>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label for="serum-creatinine">Serum Creatinine <span class="units">(μmol/L)</span></label>
                            <input type="number" id="serum-creatinine" placeholder="e.g., 80">
                        </div>
                        
                        <div class="input-group">
                            <label for="age">Age <span class="units">(years)</span></label>
                            <input type="number" id="age" placeholder="e.g., 45">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label>Gender</label>
                        <div class="gender-selection">
                            <div class="gender-option" data-gender="male">Male</div>
                            <div class="gender-option" data-gender="female">Female</div>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="calculate-btn" id="calculate-egfr">
                            <i class="fas fa-calculator"></i> Calculate eGFR
                        </button>
                        <button class="reset-btn" id="reset-egfr">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                    
                    <div class="results" id="egfr-results" style="display: none;">
                        <div class="result-item">
                            <div class="result-title">Estimated GFR:</div>
                            <div class="result-value" id="egfr-value">-</div>
                        </div>
                        
                        <div class="result-item">
                            <div class="result-title">Kidney Function:</div>
                            <div class="result-value" id="kidney-function">-</div>
                        </div>
                    </div>
                    
                    <div class="interpretation" id="egfr-interpretation" style="display: none;">
                        <div class="interpretation-title"><i class="fas fa-stethoscope"></i> Clinical Interpretation</div>
                        <div class="interpretation-content" id="egfr-interpretation-text"></div>
                    </div>
                    
                    <div class="export-actions" id="egfr-export" style="display: none;">
                        <button class="export-btn pdf-btn" id="pdf-egfr">
                            <i class="fas fa-file-pdf"></i> Export to PDF
                        </button>
                        <button class="export-btn print-btn" id="print-egfr">
                            <i class="fas fa-print"></i> Print Report
                        </button>
                    </div>
                </div>
                
                <!-- Osmolality Calculator -->
                <div class="calculator-section" id="osmolality-calculator">
                    <div class="calculator-info">
                        <h3><i class="fas fa-info-circle"></i> About Osmolality</h3>
                        <p>Osmolality measures the concentration of particles in a solution. Serum and urine osmolality tests help evaluate electrolyte balance and kidney function.</p>
                        <ul>
                            <li>Normal serum osmolality: 275-295 mOsm/kg</li>
                            <li>Normal urine osmolality: 500-800 mOsm/kg</li>
                            <li>Urine/serum osmolality ratio: &gt;1.0 indicates concentrated urine</li>
                            <li>Used to evaluate hydration status and renal concentrating ability</li>
                        </ul>
                    </div>
                    
                    <div class="sample-type">
                        <div class="type-btn active" data-type="serum">Serum</div>
                        <div class="type-btn" data-type="urine">Urine</div>
                        <div class="type-btn" data-type="both">Both</div>
                    </div>
                    
                    <div class="formula-box">
                        <div class="formula-title"><i class="fas fa-square-root-variable"></i> Formulas</div>
                        <div class="formula" id="serum-formula">Serum Osmolality = 2×[Na⁺] + [Glucose] + [Urea] (all in mmol/L)</div>
                        <div class="formula" id="urine-formula" style="display:none">Urine Osmolality = 2×([Na⁺] + [K⁺]) + [Glucose] + [Urea] (all in mmol/L)</div>
                    </div>
                    
                    <div class="sample-id-group">
                        <label for="sample-id-osm">Sample ID <span class="units">(required)</span></label>
                        <input type="text" id="sample-id-osm" placeholder="Enter sample identification" required>
                    </div>
                    
                    <div id="serum-inputs">
                        <h4 style="margin: 15px 0 10px; color: #1a2980;">Serum Parameters</h4>
                        <div class="input-row">
                            <div class="input-group">
                                <label for="sodium-serum">Sodium (Na⁺) <span class="units">(mmol/L)</span></label>
                                <input type="number" id="sodium-serum" placeholder="e.g., 140">
                            </div>
                            
                            <div class="input-group">
                                <label for="glucose-serum">Glucose <span class="units">(mmol/L)</span></label>
                                <input type="number" id="glucose-serum" placeholder="e.g., 5.5">
                            </div>
                            
                            <div class="input-group">
                                <label for="urea-serum">Urea <span class="units">(mmol/L)</span></label>
                                <input type="number" id="urea-serum" placeholder="e.g., 5.0">
                            </div>
                        </div>
                    </div>
                    
                    <div id="urine-inputs" style="display:none">
                        <h4 style="margin: 15px 0 10px; color: #1a2980;">Urine Parameters</h4>
                        <div class="input-row">
                            <div class="input-group">
                                <label for="sodium-urine">Sodium (Na⁺) <span class="units">(mmol/L)</span></label>
                                <input type="number" id="sodium-urine" placeholder="e.g., 40">
                            </div>
                            
                            <div class="input-group">
                                <label for="potassium-urine">Potassium (K⁺) <span class="units">(mmol/L)</span></label>
                                <input type="number" id="potassium-urine" placeholder="e.g., 30">
                            </div>
                            
                            <div class="input-group">
                                <label for="glucose-urine">Glucose <span class="units">(mmol/L)</span></label>
                                <input type="number" id="glucose-urine" placeholder="e.g., 0.0">
                            </div>
                            
                            <div class="input-group">
                                <label for="urea-urine">Urea <span class="units">(mmol/L)</span></label>
                                <input type="number" id="urea-urine" placeholder="e.g., 200">
                            </div>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="calculate-btn" id="calculate-osmolality">
                            <i class="fas fa-calculator"></i> Calculate Osmolality
                        </button>
                        <button class="reset-btn" id="reset-osmolality">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                    
                    <div class="results" id="osmolality-results" style="display: none;">
                        <div class="result-item" id="serum-osm-result">
                            <div class="result-title">Serum Osmolality:</div>
                            <div class="result-value" id="serum-osmolality">-</div>
                        </div>
                        
                        <div class="result-item" id="urine-osm-result" style="display:none">
                            <div class="result-title">Urine Osmolality:</div>
                            <div class="result-value" id="urine-osmolality">-</div>
                        </div>
                        
                        <div class="result-item" id="osmolality-ratio-result" style="display:none">
                            <div class="result-title">Osmolality Ratio (UOsm/SOsm):</div>
                            <div class="result-value" id="osmolality-ratio">-</div>
                        </div>
                    </div>
                    
                    <div class="interpretation" id="osmolality-interpretation" style="display: none;">
                        <div class="interpretation-title"><i class="fas fa-stethoscope"></i> Clinical Interpretation</div>
                        <div class="interpretation-content" id="osmolality-interpretation-text"></div>
                    </div>
                    
                    <div class="export-actions" id="osmolality-export" style="display: none;">
                        <button class="export-btn pdf-btn" id="pdf-osmolality">
                            <i class="fas fa-file-pdf"></i> Export to PDF
                        </button>
                        <button class="export-btn print-btn" id="print-osmolality">
                            <i class="fas fa-print"></i> Print Report
                        </button>
                    </div>
                </div>
                
                <!-- Corrected Calcium Calculator -->
                <div class="calculator-section" id="calcium-calculator">
                    <div class="calculator-info">
                        <h3><i class="fas fa-info-circle"></i> About Corrected Calcium</h3>
                        <p>Calcium levels must be adjusted based on albumin levels since approximately 50% of calcium is bound to albumin.</p>
                        <ul>
                            <li>Normal corrected calcium: 2.1-2.6 mmol/L</li>
                            <li>Hypocalcemia: &lt;2.1 mmol/L</li>
                            <li>Hypercalcemia: &gt;2.6 mmol/L</li>
                            <li>For every 10 g/L decrease in albumin, calcium decreases by 0.2 mmol/L</li>
                        </ul>
                    </div>
                    
                    <div class="formula-box">
                        <div class="formula-title"><i class="fas fa-square-root-variable"></i> Formula</div>
                        <div class="formula">Corrected Calcium (mmol/L) = Serum Calcium + 0.02 × (40 - Serum Albumin)</div>
                    </div>
                    
                    <div class="sample-id-group">
                        <label for="sample-id-calcium">Sample ID <span class="units">(required)</span></label>
                        <input type="text" id="sample-id-calcium" placeholder="Enter sample identification" required>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label for="serum-calcium">Serum Calcium <span class="units">(mmol/L)</span></label>
                            <input type="number" id="serum-calcium" placeholder="e.g., 2.2">
                        </div>
                        
                        <div class="input-group">
                            <label for="serum-albumin">Serum Albumin <span class="units">(g/L)</span></label>
                            <input type="number" id="serum-albumin" placeholder="e.g., 38">
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="calculate-btn" id="calculate-calcium">
                            <i class="fas fa-calculator"></i> Calculate Corrected Calcium
                        </button>
                        <button class="reset-btn" id="reset-calcium">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                    
                    <div class="results" id="calcium-results" style="display: none;">
                        <div class="result-item">
                            <div class="result-title">Corrected Calcium:</div>
                            <div class="result-value" id="corrected-calcium">-</div>
                        </div>
                        
                        <div class="result-item">
                            <div class="result-title">Calcium Status:</div>
                            <div class="result-value" id="calcium-status">-</div>
                        </div>
                    </div>
                    
                    <div class="interpretation" id="calcium-interpretation" style="display: none;">
                        <div class="interpretation-title"><i class="fas fa-stethoscope"></i> Clinical Interpretation</div>
                        <div class="interpretation-content" id="calcium-interpretation-text"></div>
                    </div>
                    
                    <div class="export-actions" id="calcium-export" style="display: none;">
                        <button class="export-btn pdf-btn" id="pdf-calcium">
                            <i class="fas fa-file-pdf"></i> Export to PDF
                        </button>
                        <button class="export-btn print-btn" id="print-calcium">
                            <i class="fas fa-print"></i> Print Report
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="reference">
            <p>Jazan General Hospital Laboratory Calculators v1.0</p>
        </div>
    </div>
    
    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;
        
        // Creator information (not displayed directly)
        const CREATOR_INFO = "Senior Laboratory Specialist Hatim Yahya Daghriri";
        
        document.addEventListener('DOMContentLoaded', function() {
            // Calculator navigation
            const navButtons = document.querySelectorAll('.nav-btn');
            const calculatorSections = document.querySelectorAll('.calculator-section');
            const currentCalculator = document.getElementById('current-calculator');
            
            // Function to reset a calculator
            function resetCalculator(calculatorId) {
                const calculator = document.getElementById(`${calculatorId}-calculator`);
                if (!calculator) return;
                
                // Reset inputs
                const inputs = calculator.querySelectorAll('input');
                inputs.forEach(input => {
                    if (input.type !== 'button') {
                        input.value = '';
                        input.disabled = false;
                    }
                });
                
                // Reset gender selection
                const genderOptions = calculator.querySelectorAll('.gender-option');
                if (genderOptions.length > 0) {
                    genderOptions.forEach(option => {
                        option.classList.remove('selected');
                        option.disabled = false;
                    });
                }
                
                // Hide results and export buttons
                calculator.querySelectorAll('.results, .interpretation, .export-actions').forEach(el => {
                    el.style.display = 'none';
                });
            }
            
            navButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const calculatorId = this.getAttribute('data-calc');
                    
                    // Reset all calculators
                    calculatorSections.forEach(section => {
                        const sectionId = section.id.replace('-calculator', '');
                        resetCalculator(sectionId);
                        section.classList.remove('active');
                    });
                    
                    // Update active button
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update active calculator
                    document.getElementById(`${calculatorId}-calculator`).classList.add('active');
                    
                    // Update header title
                    currentCalculator.textContent = this.textContent.trim();
                });
            });
            
            // Gender selection for eGFR
            const genderOptions = document.querySelectorAll('.gender-option');
            genderOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selection from all options
                    genderOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Select clicked option
                    this.classList.add('selected');
                    
                    // Reset results if they are displayed
                    const resultsSection = document.getElementById('egfr-results');
                    const interpretationSection = document.getElementById('egfr-interpretation');
                    const exportSection = document.getElementById('egfr-export');
                    
                    if (resultsSection.style.display !== 'none') {
                        resultsSection.style.display = 'none';
                        interpretationSection.style.display = 'none';
                        exportSection.style.display = 'none';
                    }
                });
            });
            
            // Osmolality sample type selection
            const typeButtons = document.querySelectorAll('.type-btn');
            typeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    typeButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    const type = this.getAttribute('data-type');
                    
                    // Show/hide inputs based on selection
                    if (type === 'serum') {
                        document.getElementById('serum-inputs').style.display = 'block';
                        document.getElementById('urine-inputs').style.display = 'none';
                        document.getElementById('serum-formula').style.display = 'block';
                        document.getElementById('urine-formula').style.display = 'none';
                        document.querySelector('h4[style*="Serum Parameters"]').textContent = "Parameters";
                    } else if (type === 'urine') {
                        document.getElementById('serum-inputs').style.display = 'none';
                        document.getElementById('urine-inputs').style.display = 'block';
                        document.getElementById('serum-formula').style.display = 'none';
                        document.getElementById('urine-formula').style.display = 'block';
                        document.querySelector('h4[style*="Urine Parameters"]').textContent = "Parameters";
                    } else {
                        document.getElementById('serum-inputs').style.display = 'block';
                        document.getElementById('urine-inputs').style.display = 'block';
                        document.getElementById('serum-formula').style.display = 'block';
                        document.getElementById('urine-formula').style.display = 'block';
                        document.querySelector('h4[style*="Serum Parameters"]').textContent = "Serum Parameters";
                        document.querySelector('h4[style*="Urine Parameters"]').textContent = "Urine Parameters";
                    }
                    
                    // Reset results and interpretation
                    document.getElementById('osmolality-results').style.display = 'none';
                    document.getElementById('osmolality-interpretation').style.display = 'none';
                });
            });
            
            // 24-Hour Urine Protein Calculator Logic
            const calculateUrineProteinBtn = document.getElementById('calculate-urine-protein');
            const resetUrineProteinBtn = document.getElementById('reset-urine-protein');
            
            calculateUrineProteinBtn.addEventListener('click', calculateUrineProteinResults);
            resetUrineProteinBtn.addEventListener('click', resetUrineProteinCalculator);
            
            function calculateUrineProteinResults() {
                const sampleId = document.getElementById('sample-id-urine').value;
                if (!sampleId) {
                    alert('Please enter a Sample ID');
                    return;
                }
                
                const protein = parseFloat(document.getElementById('urine-protein').value);
                const volume = parseFloat(document.getElementById('urine-volume').value);
                
                // Validate inputs
                if (isNaN(protein) || isNaN(volume) || volume === 0) {
                    alert('Please enter valid values for both protein and volume.');
                    return;
                }
                
                // Calculate 24h protein in mg and g
                const protein24hMg = protein * (volume / 100);
                const protein24hG = protein24hMg / 1000;
                
                // Determine severity
                let severity, interpretation, severityClass;
                
                if (protein24hMg < 150) {
                    severity = 'Normal';
                    severityClass = 'normal';
                    interpretation = 'Normal protein excretion. No significant proteinuria detected. Routine monitoring is sufficient.';
                } else if (protein24hMg < 500) {
                    severity = 'Mild';
                    severityClass = 'mild';
                    interpretation = 'Mild proteinuria. May indicate early kidney damage. Monitor renal function and consider evaluation for underlying conditions.';
                } else if (protein24hMg < 3500) {
                    severity = 'Moderate';
                    severityClass = 'moderate';
                    interpretation = 'Moderate proteinuria. Suggests significant kidney disease. Requires further investigation and nephrology consultation.';
                } else {
                    severity = 'Severe';
                    severityClass = 'severe';
                    interpretation = 'Severe proteinuria (nephrotic range). Indicates serious kidney damage. Urgent nephrology evaluation required.';
                }
                
                // Display results
                document.getElementById('protein-result').textContent = protein24hMg.toFixed(0) + ' mg/24h (' + protein24hG.toFixed(2) + ' g/24h)';
                
                const severityElement = document.getElementById('protein-severity');
                severityElement.textContent = severity;
                severityElement.className = 'result-value ' + severityClass;
                
                document.getElementById('urine-protein-interpretation-text').textContent = interpretation;
                
                document.getElementById('urine-protein-results').style.display = 'block';
                document.getElementById('urine-protein-interpretation').style.display = 'block';
                document.getElementById('urine-protein-export').style.display = 'flex';
                
                // Disable inputs after calculation
                document.getElementById('urine-protein').disabled = true;
                document.getElementById('urine-volume').disabled = true;
            }
            
            function resetUrineProteinCalculator() {
                document.getElementById('urine-protein').value = '';
                document.getElementById('urine-volume').value = '';
                document.getElementById('sample-id-urine').value = '';
                document.getElementById('urine-protein').disabled = false;
                document.getElementById('urine-volume').disabled = false;
                
                document.getElementById('urine-protein-results').style.display = 'none';
                document.getElementById('urine-protein-interpretation').style.display = 'none';
                document.getElementById('urine-protein-export').style.display = 'none';
            }
            
            // ACR Calculator Logic
            const calculateAcrBtn = document.getElementById('calculate-acr');
            const resetAcrBtn = document.getElementById('reset-acr');
            
            if (calculateAcrBtn) {
                calculateAcrBtn.addEventListener('click', calculateACR);
            }
            if (resetAcrBtn) {
                resetAcrBtn.addEventListener('click', resetAcrCalculator);
            }
            
            function calculateACR() {
                const sampleId = document.getElementById('sample-id-acr').value;
                if (!sampleId) {
                    alert('Please enter a Sample ID');
                    return;
                }
                
                const albumin = parseFloat(document.getElementById('urine-albumin').value); // mg/dL
                const creatinine = parseFloat(document.getElementById('urine-creatinine-acr').value); // mg/dL
                
                if (isNaN(albumin) || isNaN(creatinine) || creatinine === 0) {
                    alert('Please enter valid values for both albumin and creatinine.');
                    return;
                }
                
                // Calculate ACR
                const acr = (albumin / creatinine) * 1000;
                
                // Determine category
                let category, interpretation, categoryClass;
                
                if (acr < 30) {
                    category = 'Normal';
                    categoryClass = 'normal';
                    interpretation = 'Normal albumin excretion. No significant albuminuria detected.';
                } else if (acr < 300) {
                    category = 'Microalbuminuria';
                    categoryClass = 'mild';
                    interpretation = 'Microalbuminuria detected. This may indicate early kidney damage, especially in diabetic patients. Requires monitoring and risk factor management.';
                } else {
                    category = 'Macroalbuminuria';
                    categoryClass = 'severe';
                    interpretation = 'Macroalbuminuria detected. Indicates significant kidney damage. Requires nephrology evaluation and management.';
                }
                
                // Display results
                document.getElementById('acr-value').textContent = acr.toFixed(0) + ' mg/g';
                
                const categoryElement = document.getElementById('acr-category');
                categoryElement.textContent = category;
                categoryElement.className = 'result-value ' + categoryClass;
                
                document.getElementById('acr-interpretation-text').textContent = interpretation;
                
                document.getElementById('acr-results').style.display = 'block';
                document.getElementById('acr-interpretation').style.display = 'block';
                document.getElementById('acr-export').style.display = 'flex';
                
                // Disable inputs after calculation
                document.getElementById('urine-albumin').disabled = true;
                document.getElementById('urine-creatinine-acr').disabled = true;
            }
            
            function resetAcrCalculator() {
                document.getElementById('urine-albumin').value = '';
                document.getElementById('urine-creatinine-acr').value = '';
                document.getElementById('sample-id-acr').value = '';
                document.getElementById('urine-albumin').disabled = false;
                document.getElementById('urine-creatinine-acr').disabled = false;
                
                document.getElementById('acr-results').style.display = 'none';
                document.getElementById('acr-interpretation').style.display = 'none';
                document.getElementById('acr-export').style.display = 'none';
            }
            
            // eGFR Calculator Logic
            const calculateEgfrBtn = document.getElementById('calculate-egfr');
            const resetEgfrBtn = document.getElementById('reset-egfr');
            
            if (calculateEgfrBtn) {
                calculateEgfrBtn.addEventListener('click', calculateeGFR);
            }
            if (resetEgfrBtn) {
                resetEgfrBtn.addEventListener('click', resetEgfrCalculator);
            }
            
            function calculateeGFR() {
                const sampleId = document.getElementById('sample-id-egfr').value;
                if (!sampleId) {
                    alert('Please enter a Sample ID');
                    return;
                }
                
                const creatinine = parseFloat(document.getElementById('serum-creatinine').value); // μmol/L
                const age = parseInt(document.getElementById('age').value);
                const genderElement = document.querySelector('.gender-option.selected');
                
                if (!genderElement) {
                    alert('Please select a gender.');
                    return;
                }
                
                const gender = genderElement.getAttribute('data-gender');
                
                if (isNaN(creatinine) || isNaN(age)) {
                    alert('Please enter valid values for serum creatinine and age.');
                    return;
                }
                
                // Convert creatinine to mg/dL (1 mg/dL = 88.4 μmol/L)
                const creatinineMgDl = creatinine / 88.4;
                
                // CKD-EPI formula
                let kappa = gender === 'female' ? 0.7 : 0.9;
                let alpha = gender === 'female' ? -0.329 : -0.411;
                let genderFactor = gender === 'female' ? 1.018 : 1.0;
                
                let minCr = Math.min(creatinineMgDl / kappa, 1);
                let maxCr = Math.max(creatinineMgDl / kappa, 1);
                
                let egfr = 141 * Math.pow(minCr, alpha) * Math.pow(maxCr, -1.209) * 
                          Math.pow(0.993, age) * genderFactor;
                
                egfr = Math.round(egfr);
                
                // Determine kidney function
                let functionLevel, interpretation, functionClass;
                
                if (egfr >= 90) {
                    functionLevel = 'Normal';
                    functionClass = 'normal';
                    interpretation = 'Kidney function is normal. No evidence of kidney disease.';
                } else if (egfr >= 60) {
                    functionLevel = 'Mild Reduction';
                    functionClass = 'mild';
                    interpretation = 'Mild reduction in kidney function (G2). Monitor and manage risk factors for kidney disease.';
                } else if (egfr >= 45) {
                    functionLevel = 'Mild-Moderate';
                    functionClass = 'moderate';
                    interpretation = 'Mild to moderate reduction in kidney function (G3a). Evaluate for kidney disease and manage accordingly.';
                } else if (egfr >= 30) {
                    functionLevel = 'Moderate-Severe';
                    functionClass = 'moderate';
                    interpretation = 'Moderate to severe reduction in kidney function (G3b). Nephrology referral recommended.';
                } else if (egfr >= 15) {
                    functionLevel = 'Severe';
                    functionClass = 'severe';
                    interpretation = 'Severe reduction in kidney function (G4). Prepare for renal replacement therapy.';
                } else {
                    functionLevel = 'Kidney Failure';
                    functionClass = 'severe';
                    interpretation = 'Kidney failure (G5). Renal replacement therapy (dialysis or transplant) needed.';
                }
                
                // Display results
                document.getElementById('egfr-value').textContent = egfr + ' mL/min/1.73m²';
                document.getElementById('kidney-function').textContent = functionLevel;
                document.getElementById('kidney-function').className = 'result-value ' + functionClass;
                document.getElementById('egfr-interpretation-text').textContent = interpretation;
                
                document.getElementById('egfr-results').style.display = 'block';
                document.getElementById('egfr-interpretation').style.display = 'block';
                document.getElementById('egfr-export').style.display = 'flex';
                
                // Disable inputs after calculation
                document.getElementById('serum-creatinine').disabled = true;
                document.getElementById('age').disabled = true;
                document.querySelectorAll('.gender-option').forEach(opt => {
                    opt.disabled = true;
                });
            }
            
            function resetEgfrCalculator() {
                document.getElementById('serum-creatinine').value = '';
                document.getElementById('age').value = '';
                document.getElementById('sample-id-egfr').value = '';
                document.getElementById('serum-creatinine').disabled = false;
                document.getElementById('age').disabled = false;
                
                // Reset gender selection
                const genderOptions = document.querySelectorAll('.gender-option');
                genderOptions.forEach(option => {
                    option.classList.remove('selected');
                    option.disabled = false;
                });
                
                document.getElementById('egfr-results').style.display = 'none';
                document.getElementById('egfr-interpretation').style.display = 'none';
                document.getElementById('egfr-export').style.display = 'none';
            }
            
            // Osmolality Calculator Logic
            const calculateOsmolalityBtn = document.getElementById('calculate-osmolality');
            const resetOsmolalityBtn = document.getElementById('reset-osmolality');
            
            if (calculateOsmolalityBtn) {
                calculateOsmolalityBtn.addEventListener('click', calculateOsmolality);
            }
            if (resetOsmolalityBtn) {
                resetOsmolalityBtn.addEventListener('click', resetOsmolalityCalculator);
            }
            
            function calculateOsmolality() {
                const sampleId = document.getElementById('sample-id-osm').value;
                if (!sampleId) {
                    alert('Please enter a Sample ID');
                    return;
                }
                
                const type = document.querySelector('.type-btn.active')?.getAttribute('data-type') || 'serum';
                let serumOsmolality = null, urineOsmolality = null;
                
                // Calculate serum osmolality if selected
                if (type === 'serum' || type === 'both') {
                    const sodiumSerum = parseFloat(document.getElementById('sodium-serum').value);
                    const glucoseSerum = parseFloat(document.getElementById('glucose-serum').value);
                    const ureaSerum = parseFloat(document.getElementById('urea-serum').value);
                    
                    if (isNaN(sodiumSerum) || isNaN(glucoseSerum) || isNaN(ureaSerum)) {
                        alert('Please enter valid serum values for sodium, glucose, and urea.');
                        return;
                    }
                    
                    serumOsmolality = 2 * sodiumSerum + glucoseSerum + ureaSerum;
                }
                
                // Calculate urine osmolality if selected
                if (type === 'urine' || type === 'both') {
                    const sodiumUrine = parseFloat(document.getElementById('sodium-urine').value);
                    const potassiumUrine = parseFloat(document.getElementById('potassium-urine').value);
                    const glucoseUrine = parseFloat(document.getElementById('glucose-urine').value);
                    const ureaUrine = parseFloat(document.getElementById('urea-urine').value);
                    
                    if (isNaN(sodiumUrine) || isNaN(potassiumUrine) || isNaN(glucoseUrine) || isNaN(ureaUrine)) {
                        alert('Please enter valid urine values for sodium, potassium, glucose, and urea.');
                        return;
                    }
                    
                    urineOsmolality = 2 * (sodiumUrine + potassiumUrine) + glucoseUrine + ureaUrine;
                }
                
                // Calculate ratio if both available
                let ratio = null;
                if (serumOsmolality !== null && urineOsmolality !== null && serumOsmolality > 0) {
                    ratio = urineOsmolality / serumOsmolality;
                }
                
                // Interpretation
                let interpretation = "";
                
                // Show/hide result elements
                document.getElementById('serum-osm-result').style.display = (serumOsmolality !== null) ? 'flex' : 'none';
                document.getElementById('urine-osm-result').style.display = (urineOsmolality !== null) ? 'flex' : 'none';
                document.getElementById('osmolality-ratio-result').style.display = (ratio !== null) ? 'flex' : 'none';
                
                // Set values
                if (serumOsmolality !== null) {
                    document.getElementById('serum-osmolality').textContent = serumOsmolality.toFixed(0) + ' mOsm/kg';
                    if (serumOsmolality < 275) interpretation += "Low serum osmolality suggests possible overhydration or hyponatremia. ";
                    else if (serumOsmolality > 295) interpretation += "Elevated serum osmolality suggests possible dehydration, hyperglycemia, or uremia. ";
                    else interpretation += "Normal serum osmolality. ";
                }
                
                if (urineOsmolality !== null) {
                    document.getElementById('urine-osmolality').textContent = urineOsmolality.toFixed(0) + ' mOsm/kg';
                    if (urineOsmolality < 400) interpretation += "Low urine osmolality may indicate impaired renal concentrating ability. ";
                    else if (urineOsmolality > 800) interpretation += "High urine osmolality suggests appropriate renal concentrating ability. ";
                    else interpretation += "Normal urine osmolality. ";
                }
                
                if (ratio !== null) {
                    document.getElementById('osmolality-ratio').textContent = ratio.toFixed(2);
                    if (ratio < 1.0) interpretation += "Low urine-to-serum osmolality ratio suggests impaired renal concentrating ability. ";
                    else if (ratio > 3.0) interpretation += "High urine-to-serum osmolality ratio suggests appropriate renal concentrating ability. ";
                }
                
                document.getElementById('osmolality-interpretation-text').textContent = interpretation || "No significant abnormalities detected.";
                
                document.getElementById('osmolality-results').style.display = 'block';
                document.getElementById('osmolality-interpretation').style.display = 'block';
                document.getElementById('osmolality-export').style.display = 'flex';
                
                // Disable inputs after calculation
                if (type === 'serum' || type === 'both') {
                    document.getElementById('sodium-serum').disabled = true;
                    document.getElementById('glucose-serum').disabled = true;
                    document.getElementById('urea-serum').disabled = true;
                }
                if (type === 'urine' || type === 'both') {
                    document.getElementById('sodium-urine').disabled = true;
                    document.getElementById('potassium-urine').disabled = true;
                    document.getElementById('glucose-urine').disabled = true;
                    document.getElementById('urea-urine').disabled = true;
                }
            }
            
            function resetOsmolalityCalculator() {
                document.getElementById('sodium-serum').value = '';
                document.getElementById('glucose-serum').value = '';
                document.getElementById('urea-serum').value = '';
                document.getElementById('sodium-urine').value = '';
                document.getElementById('potassium-urine').value = '';
                document.getElementById('glucose-urine').value = '';
                document.getElementById('urea-urine').value = '';
                document.getElementById('sample-id-osm').value = '';
                
                document.getElementById('sodium-serum').disabled = false;
                document.getElementById('glucose-serum').disabled = false;
                document.getElementById('urea-serum').disabled = false;
                document.getElementById('sodium-urine').disabled = false;
                document.getElementById('potassium-urine').disabled = false;
                document.getElementById('glucose-urine').disabled = false;
                document.getElementById('urea-urine').disabled = false;
                
                document.getElementById('osmolality-results').style.display = 'none';
                document.getElementById('osmolality-interpretation').style.display = 'none';
                document.getElementById('osmolality-export').style.display = 'none';
            }
            
            // Corrected Calcium Calculator Logic
            const calculateCalciumBtn = document.getElementById('calculate-calcium');
            const resetCalciumBtn = document.getElementById('reset-calcium');
            
            if (calculateCalciumBtn) {
                calculateCalciumBtn.addEventListener('click', calculateCorrectedCalcium);
            }
            if (resetCalciumBtn) {
                resetCalciumBtn.addEventListener('click', resetCalciumCalculator);
            }
            
            function calculateCorrectedCalcium() {
                const sampleId = document.getElementById('sample-id-calcium').value;
                if (!sampleId) {
                    alert('Please enter a Sample ID');
                    return;
                }
                
                const calcium = parseFloat(document.getElementById('serum-calcium').value); // mmol/L
                const albumin = parseFloat(document.getElementById('serum-albumin').value); // g/L
                
                if (isNaN(calcium) || isNaN(albumin)) {
                    alert('Please enter valid values for serum calcium and albumin.');
                    return;
                }
                
                // Calculate corrected calcium
                // Formula: Corrected Calcium (mmol/L) = Serum Calcium + 0.02 × (40 - Serum Albumin)
                const correctedCalcium = calcium + 0.02 * (40 - albumin);
                
                // Determine status
                let status, interpretation, statusClass;
                
                if (correctedCalcium < 2.1) {
                    status = 'Hypocalcemia';
                    statusClass = 'severe';
                    interpretation = 'Hypocalcemia detected. Evaluate for possible causes including hypoparathyroidism, vitamin D deficiency, or renal disease.';
                } else if (correctedCalcium < 2.6) {
                    status = 'Normal';
                    statusClass = 'normal';
                    interpretation = 'Normal corrected calcium level. No significant abnormality detected.';
                } else {
                    status = 'Hypercalcemia';
                    statusClass = 'severe';
                    interpretation = 'Hypercalcemia detected. Evaluate for possible causes including hyperparathyroidism, malignancy, or granulomatous diseases.';
                }
                
                // Display results
                document.getElementById('corrected-calcium').textContent = correctedCalcium.toFixed(2) + ' mmol/L';
                
                const statusElement = document.getElementById('calcium-status');
                statusElement.textContent = status;
                statusElement.className = 'result-value ' + statusClass;
                
                document.getElementById('calcium-interpretation-text').textContent = interpretation;
                
                document.getElementById('calcium-results').style.display = 'block';
                document.getElementById('calcium-interpretation').style.display = 'block';
                document.getElementById('calcium-export').style.display = 'flex';
                
                // Disable inputs after calculation
                document.getElementById('serum-calcium').disabled = true;
                document.getElementById('serum-albumin').disabled = true;
            }
            
            function resetCalciumCalculator() {
                document.getElementById('serum-calcium').value = '';
                document.getElementById('serum-albumin').value = '';
                document.getElementById('sample-id-calcium').value = '';
                document.getElementById('serum-calcium').disabled = false;
                document.getElementById('serum-albumin').disabled = false;
                
                document.getElementById('calcium-results').style.display = 'none';
                document.getElementById('calcium-interpretation').style.display = 'none';
                document.getElementById('calcium-export').style.display = 'none';
            }
            
            // Export to PDF function
            function exportToPDF(calculatorId) {
                const doc = new jsPDF('p', 'mm', 'a4');
                
                // Add header
                doc.setFontSize(20);
                doc.setTextColor(26, 41, 128);
                doc.text('JAZAN GENERAL HOSPITAL', 105, 20, null, null, 'center');
                
                doc.setFontSize(16);
                doc.text('Laboratory and Blood Department', 105, 28, null, null, 'center');
                
                doc.setFontSize(14);
                doc.setTextColor(0, 0, 0);
                doc.text(document.getElementById('current-calculator').textContent + ' REPORT', 105, 38, null, null, 'center');
                
                doc.setFontSize(12);
                doc.text(`Generated on: ${new Date().toLocaleString()}`, 105, 45, null, null, 'center');
                
                // Add sample ID if available
                const sampleId = document.getElementById(`sample-id-${calculatorId}`)?.value;
                if (sampleId) {
                    doc.text(`Sample ID: ${sampleId}`, 20, 60);
                }
                
                // Add patient data
                doc.setFontSize(14);
                doc.setTextColor(26, 41, 128);
                doc.text('INPUT VALUES', 20, 70);
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                
                // Calculator-specific data
                let yPosition = 80;
                if (calculatorId === 'urine-protein') {
                    doc.text(`Urine Protein: ${document.getElementById('urine-protein').value || 'N/A'} mg/dL`, 20, yPosition);
                    doc.text(`Urine Volume: ${document.getElementById('urine-volume').value || 'N/A'} mL/24hr`, 20, yPosition + 8);
                    yPosition += 20;
                } else if (calculatorId === 'acr') {
                    doc.text(`Urine Albumin: ${document.getElementById('urine-albumin').value || 'N/A'} mg/dL`, 20, yPosition);
                    doc.text(`Urine Creatinine: ${document.getElementById('urine-creatinine-acr').value || 'N/A'} mg/dL`, 20, yPosition + 8);
                    yPosition += 20;
                } else if (calculatorId === 'egfr') {
                    doc.text(`Serum Creatinine: ${document.getElementById('serum-creatinine').value || 'N/A'} μmol/L`, 20, yPosition);
                    doc.text(`Age: ${document.getElementById('age').value || 'N/A'} years`, 20, yPosition + 8);
                    doc.text(`Gender: ${document.querySelector('.gender-option.selected')?.textContent || 'N/A'}`, 20, yPosition + 16);
                    yPosition += 28;
                } else if (calculatorId === 'osmolality') {
                    const type = document.querySelector('.type-btn.active')?.getAttribute('data-type') || 'N/A';
                    doc.text(`Sample Type: ${type.charAt(0).toUpperCase() + type.slice(1)}`, 20, yPosition);
                    yPosition += 8;
                    
                    if (type === 'serum' || type === 'both') {
                        doc.text(`Serum Sodium: ${document.getElementById('sodium-serum').value || 'N/A'} mmol/L`, 20, yPosition);
                        doc.text(`Serum Glucose: ${document.getElementById('glucose-serum').value || 'N/A'} mmol/L`, 20, yPosition + 8);
                        doc.text(`Serum Urea: ${document.getElementById('urea-serum').value || 'N/A'} mmol/L`, 20, yPosition + 16);
                        yPosition += 24;
                    }
                    if (type === 'urine' || type === 'both') {
                        doc.text(`Urine Sodium: ${document.getElementById('sodium-urine').value || 'N/A'} mmol/L`, 20, yPosition);
                        doc.text(`Urine Potassium: ${document.getElementById('potassium-urine').value || 'N/A'} mmol/L`, 20, yPosition + 8);
                        doc.text(`Urine Glucose: ${document.getElementById('glucose-urine').value || 'N/A'} mmol/L`, 20, yPosition + 16);
                        doc.text(`Urine Urea: ${document.getElementById('urea-urine').value || 'N/A'} mmol/L`, 20, yPosition + 24);
                        yPosition += 32;
                    }
                } else if (calculatorId === 'calcium') {
                    doc.text(`Serum Calcium: ${document.getElementById('serum-calcium').value || 'N/A'} mmol/L`, 20, yPosition);
                    doc.text(`Serum Albumin: ${document.getElementById('serum-albumin').value || 'N/A'} g/L`, 20, yPosition + 8);
                    yPosition += 20;
                }
                
                // Add results if available
                const resultsSection = document.getElementById(`${calculatorId}-results`);
                if (resultsSection.style.display !== 'none') {
                    doc.setFontSize(14);
                    doc.setTextColor(26, 41, 128);
                    doc.text('RESULTS', 20, yPosition);
                    yPosition += 10;
                    
                    const resultItems = resultsSection.querySelectorAll('.result-item');
                    doc.setFontSize(12);
                    doc.setTextColor(0, 0, 0);
                    
                    resultItems.forEach(item => {
                        if (item.style.display !== 'none') {
                            const title = item.querySelector('.result-title').textContent;
                            const value = item.querySelector('.result-value').textContent;
                            doc.text(`${title}: ${value}`, 20, yPosition);
                            yPosition += 8;
                        }
                    });
                    
                    yPosition += 5;
                    
                    // Add interpretation
                    const interpretation = document.getElementById(`${calculatorId}-interpretation-text`)?.textContent;
                    if (interpretation) {
                        doc.setFontSize(14);
                        doc.setTextColor(26, 41, 128);
                        doc.text('INTERPRETATION', 20, yPosition);
                        yPosition += 8;
                        
                        doc.setFontSize(12);
                        doc.setTextColor(0, 0, 0);
                        const splitText = doc.splitTextToSize(interpretation, 170);
                        doc.text(splitText, 20, yPosition);
                        yPosition += splitText.length * 5;
                    }
                }
                
                // Add footer with creator info
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text('Jazan General Hospital Laboratory Report', 105, 280, null, null, 'center');
                doc.text(`Created by ${CREATOR_INFO}`, 105, 285, null, null, 'center');
                
                // Save the PDF
                doc.save(`${calculatorId}-report.pdf`);
            }
            
            // Print function
            function printReport() {
                window.print();
            }
            
            // Attach export event listeners for all calculators
            document.querySelectorAll('.pdf-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const calculatorId = this.closest('.calculator-section').id.replace('-calculator', '');
                    exportToPDF(calculatorId);
                });
            });
            
            document.querySelectorAll('.print-btn').forEach(btn => {
                btn.addEventListener('click', printReport);
            });
        });
    </script>
</body>
</html>